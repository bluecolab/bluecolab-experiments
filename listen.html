<head>
<title>Listen</title>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/sonification.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div id="container"></div>

<div id="controls" style="">
    <button id="play">Play</button>
    <button id="pause">Pause</button>
    <button id="rewind">Rewind</button>
    <input type="range" id="speed" name="Speed" 
         min="0.5" max="2" value="1" step="0.05">
    <label for="speed">Speed</label>
</div>

<script>
// Sonification options
var soundsLike = [{
        instrument: 'sineMajor',
        instrumentMapping: {
            duration: 200,
            frequency: 'y',
            volume: 0.7
        },
        instrumentOptions: {
            minFrequency: 300,
            maxFrequency: 500
        }
    }];

// Create the chart
var chart = Highcharts.chart('container', {
    chart: { //define the visualization
        type: 'spline'
    },
    title: { //label
        text: 'Choate Pond'
    },
    yAxis: { //define yaxis
        title: { //label
            text: 'Temperature (°C)'
        }
    },
    xAxis: { //define axis
        type: 'datetime'
    },
    tooltip: { //details for the mouse-over line box
        split: true,
        valueDecimals: 0,
        valueSuffix: '°C'
    },
    plotOptions: {
        series: {
            marker: { //don't print dots along the graph
                enabled: false
            },
            cursor: 'pointer',
            // Sonify points on click
            point: {
                events: {
                    click: function () {
                        // Sonify all points at this x value
                        var targetX = this.x,
                            chart = this.series.chart;
                        chart.series.forEach(function (series) {
                            // Map instruments to the options for this series
                            var instruments = soundsLike;
                            // See if we have a point with the targetX
                            series.points.some(function (point) {
                                if (point.x === targetX) {
                                    point.sonify({
                                        instruments: instruments
                                    });
                                    return true;
                                }
                                return false;
                            });
                        });
                    }
                }
            }
        }
    },
    // Data source: Blue Colab Pace University
    data: {
        csvURL: 'https://cors-anywhere.herokuapp.com/https://vulcan.seidenberg.pace.edu/~lkeeley/temp/choate_temp.csv',
        /*csv: $.get('choate_temp.csv', function(data) {
            alert("data in the file: " + data);
            var lines = data.split('\n');
            $.each(lines, function(lineNo, line) {
            var items = line.split(',');
            c.push(items[0]);
            d.push(parseInt(items[1]));
            })}),*/
        firstRowAsNames: true,
    },
    series: [{
        name: 'temp',
        id: 'tmp',
        color: '#f4b042'
    }]
});

// Utility function that highlights a point
function highlightPoint(event, point) { //as sonification happens, highlight each point
    var chart = point.series.chart,
        hasVisibleSeries = chart.series.some(function (series) {
            return series.visible;
        });
    if (!point.isNull && hasVisibleSeries) {
        point.onMouseOver(); // Show the hover marker and tooltip
    } else {
        if (chart.tooltip) {
            chart.tooltip.hide(0);
        }
    }
}


// On speed change we reset the sonification
document.getElementById('speed').onchange = function () {
    chart.cancelSonify();
};


// Add sonification button handlers
document.getElementById('play').onclick = function () {
    if (!chart.sonification.timeline || chart.sonification.timeline.atStart()) {
        chart.sonify({
            duration: 5000 / document.getElementById('speed').value,
            order: 'simultaneous',
            pointPlayTime: 'x',
            seriesOptions: [{
                id: 'tmp',
                instruments: soundsLike,
                onPointStart: highlightPoint
            }],
            // Delete timeline on end
            onEnd: function () {
                if (chart.sonification.timeline) {
                    delete chart.sonification.timeline;
                }
            }
        });
    } else {
        chart.resumeSonify();
    }
};
document.getElementById('pause').onclick = function () {
    chart.pauseSonify();
};
document.getElementById('rewind').onclick = function () {
    chart.rewindSonify();
};
</script>
</body>
